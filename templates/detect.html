<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LeafGuard | Detect Disease</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <style>
    body {
      background: linear-gradient(to bottom, #d9f99d, #a7f3d0, #6ee7b7);
      font-family: 'Poppins', sans-serif;
      color: #064635;
    }
    .card {
      background: white;
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0px 5px 20px rgba(0, 0, 0, 0.2);
      width: 90%;
      max-width: 600px;
    }
    h1 {
      color: #064635;
    }
    label {
      font-weight: bold;
    }
    .btn {
      background-color: #064635;
      color: white;
      font-size: 1.1rem;
      padding: 0.8rem 1.5rem;
      border-radius: 12px;
      transition: all 0.3s;
    }
    .btn:hover {
      background-color: #1b6b46;
      transform: scale(1.05);
    }
    #preview {
      display: none;
      margin-top: 10px;
      border-radius: 10px;
      width: 250px;
      height: 250px;
      object-fit: cover;
      border: 3px solid #064635;
    }
    .result-box {
      background-color: #e6f9e6;
      border: 2px solid #0d9488;
      border-radius: 10px;
      padding: 1rem;
      margin-top: 1rem;
    }
  </style>
</head>
<body class="flex flex-col justify-center items-center min-h-screen px-4">

  <a href="/" class="absolute top-5 left-5 text-green-800 font-bold hover:underline">‚Üê Back</a>

  <div class="card">
    <h1 class="text-3xl font-extrabold mb-4 text-center">üåø Leaf Disease Detector</h1>
    <p class="text-gray-700 text-center mb-5">Upload your leaf photo and get results with solutions!</p>

    <form id="uploadForm" enctype="multipart/form-data" class="text-center">
      <label for="file" class="block mb-2">Choose Leaf Image:</label>
      <input type="file" name="file" id="file" accept="image/*" class="border p-2 rounded w-full mb-4">

      <img id="preview" src="#" alt="Leaf Preview">

      <label for="language" class="block mt-4 mb-2">Select Language:</label>
      <select name="language" id="language" class="border p-2 rounded w-full mb-4">
        <option value="en">English</option>
        <option value="hi">Hindi</option>
        <option value="ta">Tamil</option>
        <option value="ml">Malayalam</option>
        <option value="te">Telugu</option>
        <option value="kn">Kannada</option>
        <option value="bn">Bengali</option>
        <option value="gu">Gujarati</option>
      </select>

      <button type="submit" class="btn w-full">üîç Detect Disease</button>
    </form>

    <p id="loading" class="text-center text-gray-600 mt-4 hidden">‚è≥ Please wait... detecting disease...</p>

    <div id="result" class="result-box hidden">
      <h2 class="text-2xl font-bold mb-2" id="disease-name"></h2>
      <p><b>Confidence:</b> <span id="confidence"></span>%</p>
      <p><b>Fertilizer to Use:</b> <span id="fertilizer"></span></p>
      <p><b>Prevention Tips:</b> <span id="prevention"></span></p>

      <p class="mt-3 italic text-green-900" id="translated-text"></p>

      <button id="play-audio" class="btn mt-4 hidden">‚ñ∂Ô∏è Listen</button>
    </div>
  </div>

  <script>
    const form = document.getElementById('uploadForm');
    const preview = document.getElementById('preview');
    const loading = document.getElementById('loading');
    const resultDiv = document.getElementById('result');
    const playButton = document.getElementById('play-audio');
    let audio = null;

    document.getElementById('file').addEventListener('change', e => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = event => {
          preview.src = event.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      loading.classList.remove('hidden');
      resultDiv.classList.add('hidden');
      playButton.classList.add('hidden');

      const formData = new FormData(form);
      try {
        const res = await axios.post('/predict', formData, {
          headers: { 'Content-Type': 'multipart/form-data' }
        });
        const data = res.data;
        loading.classList.add('hidden');
        resultDiv.classList.remove('hidden');

        document.getElementById('disease-name').textContent = "Disease: " + data.disease;
        document.getElementById('confidence').textContent = data.confidence;
        document.getElementById('fertilizer').textContent = data.fertilizer;
        document.getElementById('prevention').textContent = data.prevention;
        document.getElementById('translated-text').textContent = data.translated;

        if (data.audio) {
          audio = new Audio(data.audio);
          playButton.classList.remove('hidden');
        }
      } catch (err) {
        console.error(err);
        loading.textContent = "‚ùå Error detecting disease. Please try again.";
      }
    });

    playButton.addEventListener('click', () => {
      if (audio) audio.play();
    });
  </script>
</body>
</html>

